// src/PaymentWidget.js
import React, { useState } from 'react';
import PropTypes from 'prop-types';
import axios from 'axios';

const PaymentWidget = ({ apiUrl }) => {
  const [amount, setAmount] = useState('');
  const [currency, setCurrency] = useState('INR');
  const [description, setDescription] = useState('');
  const [paymentLink, setPaymentLink] = useState('');
  const [iframeSrc, setIframeSrc] = useState('');
  const [showIframe, setShowIframe] = useState(false);

  const handleCreatePaymentLink = async () => {
    try {
        const response = await fetch(`${apiUrl}/create-payment-link`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ amount, currency, description }),
          });
          const data = await response.json();
      setPaymentLink(data.short_url);
      setIframeSrc(data.short_url);
      setShowIframe(true);
    } catch (error) {
      console.error('Error creating payment link:', error);
    }
  };

  return (
    <div>
      <h1>Payment</h1>
      <input
        type="number"
        placeholder="Amount"
        value={amount}
        onChange={(e) => setAmount(e.target.value)}
      />
      <input
        type="text"
        placeholder="Description"
        value={description}
        onChange={(e) => setDescription(e.target.value)}
      />
      <button onClick={handleCreatePaymentLink}>Pay now</button>

      {showIframe && iframeSrc && (
        <div>
          <h2>Page View:</h2>
          <iframe
            src={iframeSrc}
            title="Embedded Page"
            style={{ width: '100%', height: '600px', border: 'none' }}
          ></iframe>
        </div>
      )}
    </div>
  );
};

PaymentWidget.propTypes = {
  apiUrl: PropTypes.string.isRequired,
};

export default PaymentWidget;